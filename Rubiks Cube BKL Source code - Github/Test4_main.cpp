//-----------------------------------------------------------------------------
// DirectInput & Kinematics: Test 4
// Uses Direct Input 8 Interfaces.
// Original provided at SHU During Programming For Games

//-----------------------------------------------------------------------------
// RUBIKS CUBE AUTHOR: BRIAN LEMAN, SID 16024894 D.O.B. 22/01/1985 START DATE: 30/09/2009
#define STRICT
#define DIRECTINPUT_VERSION 0x0800
#define D3D_DEBUG_INFO	// Enable debugging information, so the .NET environment can help you.
#define DEBUG_VS
#define DEBUG_PS 
//-----------------------------------------------------------------------------
// Include these files
#include <windows.h>	// Windows library (for window functions, menus, dialog boxes, etc)
#include <d3dx9.h>		// Direct 3D library (for all Direct 3D functions)
#include <dinput.h>		// Direct Input library (for Direct Input functions)
#include "RubikCubeApp.h"
D3DWindow* rubikApp = nullptr;
//-----------------------------------------------------------------------------
// WinMain() - The application's entry point.
// This sort of procedure is mostly standard, and could be used in most DirectX applications.
int WINAPI WinMain(HINSTANCE hInst, HINSTANCE hPrevInstance, LPSTR, int)
{
	rubikApp = new RubikCubeApp(hInst, hPrevInstance);
    if (SUCCEEDED(rubikApp->SetupD3D()))
    {        		
		// Initialise Direct Input and acquire the keyboard
		if (SUCCEEDED(rubikApp->SetupDirectInput()))
		{				
			//MessageBox(hwnd,"Keyboard Configuration\n\WASD:\tRotate Whole Cube\nSPACE:\tReset View\n\nTab:\tCycle Through Rotatable Sections/Complete Rotation\n\tPage Up Or Page Down Keys:\tRotate\n\nR:\tHOLD to rapidly rotate sections\n\nQ:\tTo Quit","Controls",MB_OK | MB_ICONINFORMATION);
			// Show the window
			rubikApp->Show();

			// Enter the message loop
			MSG msg;
			ZeroMemory(&msg, sizeof(msg));
			while (msg.message != WM_QUIT)
			{
				if (PeekMessage(&msg, NULL, 0U, 0U, PM_REMOVE))
				{
					TranslateMessage(&msg);
					DispatchMessage(&msg);
				}
				else
				{
						
					rubikApp->Render();
					rubikApp->ProcessKeyboardInput();
				}
			}            
        }
    }
	
	rubikApp->CleanUp();

    return 0;
}

//-----------------------------------------------------------------------------
	// The window's message handling function.
LRESULT WINAPI D3DWindow::MsgProc(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
	switch (msg)
	{
		case WM_SIZE:
		{
			rubikApp->mScreenHeight = (float)HIWORD(lParam);
			rubikApp->mScreenWidth = (float)LOWORD(lParam);
			break;
		}
		case WM_DESTROY:
		{
			// Respond to a Windows destroy event.
			// Usually generated by clicking on the close box on the window.
			PostQuitMessage(0);
			return 0;
		}
	}

	return DefWindowProc(hWnd, msg, wParam, lParam);
}


